<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cuestionario previo ¬∑ Seguro de Gastos M√©dicos Mayores ¬∑ Christian GarBa</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --brand:#0B5ED7;
      --brand-dark:#0846a8;
      --ink:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --bg:#f3f4f6;
      --card:#ffffff;
      --error:#b91c1c;
    }
    *{box-sizing:border-box;}
    html,body{margin:0;padding:0;font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);}
    body{padding:16px;}
    .container{max-width:960px;margin:0 auto;}

    /* Header */
    .header{background:var(--card);border-radius:16px;padding:14px 18px;border:1px solid var(--border);display:flex;align-items:center;gap:14px;margin-bottom:16px;}
    .header-logo img{height:60px;width:auto;display:block;}
    .header-text{flex:1;}
    .title{font-size:20px;font-weight:700;margin:0;}
    .subtitle{font-size:13px;color:var(--muted);margin:2px 0 0;}
    .header-meta{text-align:right;font-size:13px;color:#374151;min-width:180px;}
    .header-meta div{white-space:nowrap;}

    /* Info banner */
    .info-banner{background:#111827;color:#e5e7eb;border-radius:14px;padding:14px 16px;margin-bottom:18px;border:1px solid #1f2937;}
    .info-banner h2{margin:0 0 6px;font-size:16px;}
    .info-banner p{margin:4px 0;font-size:13px;line-height:1.45;}
    .info-banner-time strong{font-weight:600;}
    .info-banner-note{color:#cbd5f5;}

    /* Cards / sections */
    .section-card{background:var(--card);border-radius:14px;padding:18px 18px 20px;border:1px solid var(--border);margin-bottom:16px;}
    .section-title{margin:0 0 6px;font-size:18px;font-weight:700;}
    .section-helper{margin:0 0 14px;font-size:13px;color:var(--muted);}
    .section-subtitle{margin:18px 0 8px;font-size:15px;font-weight:600;}

    .field-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px 16px;}
    .field{display:flex;flex-direction:column;font-size:14px;}
    .field-full{grid-column:1 / -1;}
    label{font-size:13px;font-weight:500;margin-bottom:4px;color:#111827;}
    .req{color:var(--error);font-weight:600;}

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    input[type="number"],
    select,
    textarea{
      border:1px solid var(--border);
      border-radius:8px;
      padding:9px 10px;
      font-size:14px;
      font-family:inherit;
      background:#f9fafb;
      color:var(--ink);
      transition:border .15s, box-shadow .15s, background .15s;
    }
    textarea{resize:vertical;min-height:80px;}
    input:focus,select:focus,textarea:focus{
      outline:none;
      border-color:var(--brand);
      box-shadow:0 0 0 2px rgba(11,94,215,0.18);
      background:#ffffff;
    }
    input[readonly]{background:#f3f4f6;color:#6b7280;}

    .radio-row,.checkbox-row{display:flex;flex-wrap:wrap;gap:8px 16px;margin-top:2px;font-size:13px;}
    .radio-row label,.checkbox-row label{display:inline-flex;align-items:center;gap:4px;font-weight:400;cursor:pointer;}

    .muted{font-size:12px;color:var(--muted);margin-top:3px;}

    /* Dependientes */
    .dependientes-box{background:#f9fafb;border-radius:10px;border:1px solid #e5e7eb;padding:12px 12px 10px;margin-top:8px;}
    .dependiente-card{border-radius:10px;border:1px solid #e5e7eb;padding:12px;margin-bottom:10px;background:#ffffff;}
    .dependiente-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
    .dependiente-header h4{margin:0;font-size:14px;font-weight:600;}
    .dependiente-remove{background:none;border:none;color:var(--error);font-size:12px;cursor:pointer;}
    .add-dependiente-btn{margin-top:8px;font-size:13px;padding:8px 12px;border-radius:999px;border:1px solid var(--brand);background:#eff6ff;color:#1d4ed8;cursor:pointer;font-weight:500;}
    .add-dependiente-btn:hover{background:#dbeafe;}

    /* Errors */
    .errors-box{display:none;background:#fef2f2;border:1px solid #fecaca;border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:13px;color:#7f1d1d;}
    .errors-box ul{margin:6px 0 0 18px;padding:0;}

    /* Buttons */
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px;}
    .btn-primary{background:var(--brand);border:1px solid var(--brand);color:#fff;border-radius:999px;padding:10px 18px;font-size:14px;font-weight:600;cursor:pointer;}
    .btn-primary:hover{background:var(--brand-dark);}
    .btn-secondary{background:#fff;border:1px solid var(--border);color:#111827;border-radius:999px;padding:9px 16px;font-size:13px;font-weight:500;cursor:pointer;}
    .btn-secondary:hover{background:#f3f4f6;}

    /* Footer note */
    .footnote{font-size:11px;color:#6b7280;margin-top:8px;}

    /* Small screens */
    @media (max-width:640px){
      body{padding:10px;}
      .header{flex-direction:column;align-items:flex-start;}
      .header-meta{text-align:left;}
    }

    /* Print */
    @media print{
      body{background:#ffffff;padding:0;}
      .header,.section-card,.info-banner{box-shadow:none;border-color:#d1d5db;}
      .actions{display:none!important;}
    }
  </style>
</head>
<body>
<div class="container">

  <!-- Encabezado -->
  <header class="header">
    <div class="header-logo">
      <!-- Aseg√∫rate de tener este archivo en el repo -->
      <img src="./logo-garba.png" alt="Christian GarBa ¬∑ Seguros con Estrategia">
    </div>
    <div class="header-text">
      <h1 class="title">Cuestionario previo ¬∑ Seguro de Gastos M√©dicos Mayores</h1>
      <p class="subtitle">La informaci√≥n que compartas nos ayudar√° a recomendarte el plan adecuado para ti y tu familia.</p>
    </div>
    <div class="header-meta">
      <div>üìû 662 417 6032</div>
      <div>‚úâÔ∏è christian.garcia@sfgarba.com.mx</div>
    </div>
  </header>

  <!-- Banner informativo -->
  <section class="info-banner">
    <h2>Antes de empezar</h2>
    <p>
      Este formulario es un cuestionario previo para conocer tu situaci√≥n y avanzar m√°s r√°pido en la propuesta de seguro.
      No est√°s contratando nada todav√≠a, solo nos ayudas a entender tu perfil.
    </p>
    <p class="info-banner-time">
      ‚è± <strong>Tiempo estimado de llenado:</strong><br>
      ‚Ä¢ Solo titular: <strong>5‚Äì7 minutos</strong><br>
      ‚Ä¢ Titular + familia: <strong>10‚Äì12 minutos</strong>
    </p>
    <p class="info-banner-note">
      Si no tienes alg√∫n dato exacto a la mano, puedes indicarlo de forma aproximada y lo afinamos juntos.
      Lo importante es responder con honestidad para evitar problemas al momento de un siniestro.
    </p>
  </section>

  <!-- Caja de errores generales -->
  <div id="formErrors" class="errors-box">
    <strong>Revisa lo siguiente antes de enviar:</strong>
    <ul id="errorsList"></ul>
  </div>

  <!-- FORMULARIO PRINCIPAL -->
  <form id="gmmForm" novalidate>
    <!-- 1. Datos del titular -->
    <section class="section-card">
      <h2 class="section-title">1. Datos del titular</h2>
      <p class="section-helper">
        El titular es la persona a nombre de quien estar√° la p√≥liza. En seguros de gastos m√©dicos no puede ser menor de 18 a√±os.
      </p>

      <div class="field-grid">
        <div class="field field-full">
          <label for="titular_nombre">Nombre completo del titular <span class="req">*</span></label>
          <input type="text" id="titular_nombre" name="titular_nombre" placeholder="Nombre(s) y apellidos" required>
        </div>

        <div class="field">
          <label for="titular_rfc">RFC del titular <span class="req">*</span></label>
          <input type="text" id="titular_rfc" name="titular_rfc" placeholder="Ej. GABC800619HXX" maxlength="13" required>
          <div class="muted">Lo usamos solo para identificarte y estimar tu fecha de nacimiento.</div>
        </div>

        <div class="field">
          <label for="titular_fecha_nac">Fecha de nacimiento <span class="req">*</span></label>
          <input type="date" id="titular_fecha_nac" name="titular_fecha_nac" required>
        </div>

        <div class="field">
          <label for="titular_edad">Edad (a√±os)</label>
          <input type="number" id="titular_edad" name="titular_edad" readonly>
          <div class="muted">Se calcula autom√°ticamente a partir de tu fecha de nacimiento.</div>
        </div>

        <div class="field">
          <label>Sexo <span class="req">*</span></label>
          <div class="radio-row">
            <label><input type="radio" name="titular_sexo" value="Hombre" required> Hombre</label>
            <label><input type="radio" name="titular_sexo" value="Mujer"> Mujer</label>
          </div>
        </div>

        <div class="field">
          <label for="titular_estado_civil">Estado civil</label>
          <select id="titular_estado_civil" name="titular_estado_civil">
            <option value="">Selecciona una opci√≥n</option>
            <option value="Soltero(a)">Soltero(a)</option>
            <option value="Casado(a)">Casado(a)</option>
            <option value="Uni√≥n libre">Uni√≥n libre</option>
            <option value="Divorciado(a)">Divorciado(a)</option>
            <option value="Viudo(a)">Viudo(a)</option>
          </select>
        </div>

        <div class="field">
          <label for="titular_telefono">Tel√©fono m√≥vil <span class="req">*</span></label>
          <input type="tel" id="titular_telefono" name="titular_telefono" placeholder="10 d√≠gitos" required>
        </div>

        <div class="field">
          <label for="titular_email">Correo electr√≥nico <span class="req">*</span></label>
          <input type="email" id="titular_email" name="titular_email" placeholder="tucorreo@ejemplo.com" required>
        </div>

        <div class="field">
          <label for="titular_ciudad">Ciudad y estado <span class="req">*</span></label>
          <input type="text" id="titular_ciudad" name="titular_ciudad" placeholder="Ej. Hermosillo, Sonora" required>
        </div>

        <div class="field">
          <label for="titular_cp">C√≥digo postal</label>
          <input type="text" id="titular_cp" name="titular_cp" placeholder="Ej. 83240" maxlength="5">
        </div>

        <div class="field field-full">
          <label for="titular_ocupacion">Ocupaci√≥n / actividad principal</label>
          <input type="text" id="titular_ocupacion" name="titular_ocupacion" placeholder="Ej. Empresario, empleado, profesionista independiente, etc.">
        </div>
      </div>
    </section>

    <!-- 2. Tipo de cobertura y situaci√≥n actual -->
    <section class="section-card">
      <h2 class="section-title">2. Cobertura solicitada y situaci√≥n actual</h2>
      <p class="section-helper">
        Esta secci√≥n nos ayuda a entender si es tu primer seguro o si est√°s buscando optimizar una p√≥liza que ya tienes.
      </p>

      <div class="field-grid">
        <div class="field field-full">
          <label>¬øPara qui√©n ser√° el seguro? <span class="req">*</span></label>
          <div class="radio-row">
            <label><input type="radio" name="tipo_contratacion" value="Solo titular" required> Solo para m√≠</label>
            <label><input type="radio" name="tipo_contratacion" value="Titular y familia"> Para m√≠ y mi familia</label>
          </div>
        </div>

        <div class="field field-full">
          <label>Respecto a seguros de gastos m√©dicos mayores, hoy tu situaci√≥n es: <span class="req">*</span></label>
          <div class="radio-row">
            <label><input type="radio" name="situacion_seguro" value="Nunca he tenido seguro de gastos m√©dicos" required> Nunca he tenido seguro de gastos m√©dicos</label>
            <label><input type="radio" name="situacion_seguro" value="Tengo seguro actualmente (cambio de aseguradora)"> Tengo seguro actualmente (cambio de aseguradora)</label>
            <label><input type="radio" name="situacion_seguro" value="Tuve seguro antes pero hoy no estoy asegurado"> Tuve seguro antes pero hoy no estoy asegurado</label>
          </div>
        </div>

        <!-- Datos de p√≥liza actual / anterior -->
        <div class="field-grid field-full" id="bloquePolizaActual" style="display:none;margin-top:8px;">
          <div class="field">
            <label for="aseguradora_actual">Compa√±√≠a actual/anterior</label>
            <input type="text" id="aseguradora_actual" name="aseguradora_actual" placeholder="Ej. Allianz, AXA, etc.">
          </div>
          <div class="field">
            <label for="plan_actual">Nombre del plan</label>
            <input type="text" id="plan_actual" name="plan_actual" placeholder="Ej. Cl√°sico, Premium, etc.">
          </div>
          <div class="field">
            <label for="deducible_actual">Deducible aproximado</label>
            <input type="text" id="deducible_actual" name="deducible_actual" placeholder="Ej. $20,000">
          </div>
          <div class="field">
            <label for="coaseguro_actual">Coaseguro aproximado</label>
            <input type="text" id="coaseguro_actual" name="coaseguro_actual" placeholder="Ej. 10%, 20%">
          </div>
          <div class="field">
            <label for="antiguedad_poliza">Antig√ºedad aproximada de la p√≥liza</label>
            <input type="text" id="antiguedad_poliza" name="antiguedad_poliza" placeholder="Ej. 3 a√±os, desde 2019, etc.">
          </div>
        </div>

        <div class="field">
          <label for="nivel_hospitalario">Tipo de red hospitalaria que te interesar√≠a</label>
          <select id="nivel_hospitalario" name="nivel_hospitalario">
            <option value="">Selecciona una opci√≥n</option>
            <option value="Red b√°sica / regional">Red b√°sica / regional</option>
            <option value="Red intermedia">Red intermedia</option>
            <option value="Red alta / hospitales de referencia">Red alta / hospitales de referencia</option>
            <option value="A√∫n no estoy seguro, quiero comparar">A√∫n no estoy seguro, quiero comparar</option>
          </select>
        </div>

        <div class="field">
          <label for="zona_hospitalaria">Ciudad / zona donde te atender√≠as principalmente</label>
          <input type="text" id="zona_hospitalaria" name="zona_hospitalaria" placeholder="Ej. Hermosillo, CDMX, Guadalajara, etc.">
        </div>

        <div class="field">
          <label for="deducible_preferido">Deducible que estar√≠as dispuesto a manejar</label>
          <select id="deducible_preferido" name="deducible_preferido">
            <option value="">No estoy seguro, quiero opciones</option>
            <option value="Deducible bajo">Deducible bajo</option>
            <option value="Deducible medio">Deducible medio</option>
            <option value="Deducible alto">Deducible alto</option>
          </select>
        </div>

        <div class="field">
          <label for="coaseguro_preferido">Coaseguro que te resulta c√≥modo</label>
          <select id="coaseguro_preferido" name="coaseguro_preferido">
            <option value="">No estoy seguro, quiero opciones</option>
            <option value="Coaseguro bajo (ej. 5‚Äì10%)">Coaseguro bajo (ej. 5‚Äì10%)</option>
            <option value="Coaseguro medio (ej. 10‚Äì20%)">Coaseguro medio (ej. 10‚Äì20%)</option>
            <option value="Me adapto seg√∫n la prima">Me adapto seg√∫n la prima</option>
          </select>
        </div>
      </div>

      <!-- Dependientes (solo se muestra si elige "Titular y familia") -->
      <div id="dependientesWrapper" style="display:none;margin-top:12px;">
        <h3 class="section-subtitle">Integrantes de la familia a incluir</h3>
        <p class="section-helper">
          Solo llena esta parte si tambi√©n deseas cotizar para tu c√≥nyuge e hijos. Puedes agregar hasta 5 integrantes.
        </p>
        <div id="dependientesBox" class="dependientes-box"></div>
        <button type="button" id="addDependienteBtn" class="add-dependiente-btn">
          + Agregar integrante de la familia
        </button>
      </div>
    </section>

    <!-- 3. Salud y antecedentes -->
    <section class="section-card">
      <h2 class="section-title">3. Salud y antecedentes</h2>
      <p class="section-helper">
        No se trata de estar ‚Äúperfecto‚Äù, sino de que el seguro est√© bien configurado. Responde con honestidad; 
        esto ayuda a evitar exclusiones o problemas al momento de una reclamaci√≥n.
      </p>

      <!-- A) Estado actual y medicamentos -->
      <h3 class="section-subtitle">A) Estado actual y medicamentos</h3>
      <div class="field-grid">
        <!-- Medicamentos -->
        <div class="field">
          <label>¬øTomas actualmente alg√∫n medicamento? <span class="req">*</span></label>
          <div class="radio-row">
            <label><input type="radio" name="toma_medicamentos" value="si" required> S√≠</label>
            <label><input type="radio" name="toma_medicamentos" value="no"> No</label>
          </div>
        </div>
        <div class="field field-full" data-conditional="toma_medicamentos:si" style="display:none;">
          <label for="detalle_medicamentos">Si respondiste ‚ÄúS√≠‚Äù, indica qu√© medicamento tomas y para qu√© diagn√≥stico.</label>
          <textarea id="detalle_medicamentos" name="detalle_medicamentos" rows="3" placeholder="Ej. Levotiroxina 75 mcg desde 2015 por hipotiroidismo controlado."></textarea>
        </div>

        <!-- Cirug√≠as -->
        <div class="field">
          <label>¬øHas tenido alguna cirug√≠a previa? <span class="req">*</span></label>
          <div class="radio-row">
            <label><input type="radio" name="cirugias_previas" value="si" required> S√≠</label>
            <label><input type="radio" name="cirugias_previas" value="no"> No</label>
          </div>
        </div>
        <div class="field field-full" data-conditional="cirugias_previas:si" style="display:none;">
          <label for="detalle_cirugias">Si respondiste ‚ÄúS√≠‚Äù, indica tipo de cirug√≠a, a√±o y si quedaste con alguna secuela.</label>
          <textarea id="detalle_cirugias" name="detalle_cirugias" rows="3" placeholder="Ej. Cirug√≠a de menisco en 2018, actualmente sin dolor ni limitaci√≥n."></textarea>
        </div>

        <!-- Hospitalizaciones -->
        <div class="field">
          <label>¬øHas estado hospitalizado en los √∫ltimos 5 a√±os? <span class="req">*</span></label>
          <div class="radio-row">
            <label><input type="radio" name="hospitalizaciones" value="si" required> S√≠</label>
            <label><input type="radio" name="hospitalizaciones" value="no"> No</label>
          </div>
        </div>
        <div class="field field-full" data-conditional="hospitalizaciones:si" style="display:none;">
          <label for="detalle_hospitalizaciones">Si respondiste ‚ÄúS√≠‚Äù, indica el motivo, fecha aproximada y evoluci√≥n.</label>
          <textarea id="detalle_hospitalizaciones" name="detalle_hospitalizaciones" rows="3" placeholder="Ej. Neumon√≠a en 2022, 3 d√≠as hospitalizado, actualmente sin secuelas."></textarea>
        </div>
      </div>

      <!-- B) H√°bitos relevantes -->
      <h3 class="section-subtitle">B) H√°bitos relevantes</h3>
      <div class="field-grid">
        <div class="field">
          <label>¬øFumas actualmente? <span class="req">*</span></label>
          <div class="radio-row">
            <label><input type="radio" name="fuma_actualmente" value="si" required> S√≠</label>
            <label><input type="radio" name="fuma_actualmente" value="no"> No</label>
          </div>
        </div>
        <div class="field field-full" data-conditional="fuma_actualmente:si" style="display:none;">
          <div class="field-grid">
            <div class="field">
              <label for="fuma_desde">¬øDesde cu√°ndo fumas? (a√±o o edad aproximada)</label>
              <input type="text" id="fuma_desde" name="fuma_desde" placeholder="Ej. Desde 2010 o desde los 20 a√±os">
            </div>
            <div class="field">
              <label for="fuma_cigs">¬øCu√°ntos cigarrillos al d√≠a? (aproximado)</label>
              <input type="number" id="fuma_cigs" name="fuma_cigs" min="0" placeholder="Ej. 5, 10, 20">
            </div>
          </div>
        </div>
      </div>

      <!-- C) Condiciones preexistentes -->
      <h3 class="section-subtitle">C) Condiciones m√©dicas preexistentes</h3>
      <div class="field field-full">
        <label>¬øHas tenido o tienes diagn√≥stico de alguno de los siguientes?</label>
        <div class="checkbox-row">
          <label><input type="checkbox" name="cond_preexistentes" value="Diabetes"> Diabetes</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Hipertensi√≥n"> Hipertensi√≥n</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Enfermedad tiroidea"> Enfermedad tiroidea</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Colesterol o triglic√©ridos altos"> Colesterol / triglic√©ridos altos</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Asma o problemas respiratorios"> Asma / problemas respiratorios</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Enfermedades card√≠acas"> Enfermedades card√≠acas</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Problemas gastrointestinales cr√≥nicos"> Problemas gastrointestinales cr√≥nicos</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Enfermedades renales o hep√°ticas"> Enfermedades renales / hep√°ticas</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Enfermedades autoinmunes"> Enfermedades autoinmunes</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Problemas de columna o articulaciones"> Problemas de columna / articulaciones</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Trastornos neurol√≥gicos"> Trastornos neurol√≥gicos</label>
          <label><input type="checkbox" name="cond_preexistentes" value="C√°ncer o tumores"> C√°ncer o tumores</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Ansiedad o depresi√≥n"> Ansiedad / depresi√≥n</label>
          <label><input type="checkbox" name="cond_preexistentes" value="Otros"> Otros (especificar en detalles)</label>
        </div>
        <div class="muted">
          Si no tienes ninguna de las anteriores, puedes dejar todo sin marcar y lo aclar√°remos en la caja de detalles.
        </div>
      </div>

      <!-- D) Antecedentes adicionales -->
      <h3 class="section-subtitle">D) Antecedentes adicionales</h3>
      <div class="field-grid">
        <div class="field">
          <label>¬øTe ha rechazado alguna aseguradora por temas de salud?</label>
          <div class="radio-row">
            <label><input type="radio" name="rechazo_aseguradora" value="si"> S√≠</label>
            <label><input type="radio" name="rechazo_aseguradora" value="no"> No</label>
          </div>
        </div>
        <div class="field">
          <label>¬øTienes alguna cirug√≠a programada?</label>
          <div class="radio-row">
            <label><input type="radio" name="cirugia_programada" value="si"> S√≠</label>
            <label><input type="radio" name="cirugia_programada" value="no"> No</label>
          </div>
        </div>
        <div class="field field-full">
          <label>¬øPadeces alguna limitaci√≥n o discapacidad permanente?</label>
          <div class="radio-row">
            <label><input type="radio" name="discapacidad" value="si"> S√≠</label>
            <label><input type="radio" name="discapacidad" value="no"> No</label>
          </div>
        </div>
      </div>

      <!-- E) Caja de testimonio m√©dico -->
      <h3 class="section-subtitle">E) Detalles m√©dicos adicionales</h3>
      <div class="field field-full">
        <label for="detalles_medicos">
          Si deseas agregar alguna aclaraci√≥n, antecedente, diagn√≥stico o contexto adicional para que tu seguro sea configurado correctamente, escr√≠belo aqu√≠.
        </label>
        <textarea id="detalles_medicos" name="detalles_medicos" rows="4"
          placeholder="Ej. 'Tuve ansiedad en pandemia pero ya no tomo medicamento', 'Resistencia a la insulina desde 2022, controlada con alimentaci√≥n', etc."></textarea>
        <div class="muted">
          Si en alguna de las preguntas respondiste ‚ÄúS√≠‚Äù o marcaste alguna condici√≥n, es recomendable que expliques aqu√≠ los detalles.
        </div>
      </div>
    </section>

    <!-- Acciones -->
    <section class="section-card">
      <h2 class="section-title">4. Enviar informaci√≥n a tu asesor</h2>
      <p class="section-helper">
        Antes de enviarlo a WhatsApp, revisaremos que est√©n cubiertos los datos m√°s importantes. 
        No se compartir√° esta informaci√≥n con nadie m√°s.
      </p>

      <div class="actions">
        <button type="button" id="sendWhatsApp" class="btn-primary">
          Enviar a mi asesor por WhatsApp
        </button>
        <button type="reset" class="btn-secondary">
          Limpiar formulario
        </button>
      </div>
      <p class="footnote">
        Al enviar este formulario confirmas que la informaci√≥n proporcionada es verdadera a tu leal saber y entender.
        Esto no implica a√∫n la contrataci√≥n de ninguna p√≥liza; es un paso previo de an√°lisis.
      </p>
    </section>
  </form>
</div>

<script>
  // Utilidades
  const $ = id => document.getElementById(id);

  // 1) RFC -> Fecha de nacimiento + edad
  const rfcInput = $('titular_rfc');
  const fechaInput = $('titular_fecha_nac');
  const edadInput = $('titular_edad');

  function calcEdadFromDate(dateStr){
    if(!dateStr) return '';
    const today = new Date();
    const dob = new Date(dateStr);
    if(isNaN(dob.getTime())) return '';
    let age = today.getFullYear() - dob.getFullYear();
    const m = today.getMonth() - dob.getMonth();
    if(m < 0 || (m === 0 && today.getDate() < dob.getDate())) age--;
    return age;
  }

  rfcInput.addEventListener('blur', ()=>{
    const rfc = rfcInput.value.trim();
    if(rfc.length < 10) return; // no intentamos
    const fechaPart = rfc.substring(4, 10); // YYMMDD
    if(!/^\d{6}$/.test(fechaPart)) return;
    const yy = parseInt(fechaPart.substring(0,2),10);
    const mm = parseInt(fechaPart.substring(2,4),10);
    const dd = parseInt(fechaPart.substring(4,6),10);
    if(mm < 1 || mm > 12 || dd < 1 || dd > 31) return;

    const currentYear = new Date().getFullYear() % 100;
    const century = (yy <= currentYear ? 2000 : 1900);
    const fullYear = century + yy;
    const iso = `${fullYear.toString().padStart(4,'0')}-${mm.toString().padStart(2,'0')}-${dd.toString().padStart(2,'0')}`;

    if(!fechaInput.value){
      fechaInput.value = iso;
      const edad = calcEdadFromDate(iso);
      if(edad) edadInput.value = edad;
    }
  });

  fechaInput.addEventListener('change', ()=>{
    const edad = calcEdadFromDate(fechaInput.value);
    if(edad) edadInput.value = edad;
  });

  // 2) Mostrar/ocultar bloque de p√≥liza actual seg√∫n situaci√≥n
  const radiosSituacion = document.querySelectorAll('input[name="situacion_seguro"]');
  const bloquePolizaActual = $('bloquePolizaActual');
  radiosSituacion.forEach(r =>{
    r.addEventListener('change', ()=>{
      if(r.value === 'Tengo seguro actualmente (cambio de aseguradora)' ||
         r.value === 'Tuve seguro antes pero hoy no estoy asegurado'){
        bloquePolizaActual.style.display = 'grid';
      }else{
        bloquePolizaActual.style.display = 'none';
      }
    });
  });

  // 3) Mostrar dependientes si selecciona "Titular y familia"
  const radiosTipoContratacion = document.querySelectorAll('input[name="tipo_contratacion"]');
  const dependientesWrapper = $('dependientesWrapper');
  const dependientesBox = $('dependientesBox');
  const addDepBtn = $('addDependienteBtn');
  let depCount = 0;
  const MAX_DEP = 5;

  function createDependienteCard(index){
    const card = document.createElement('div');
    card.className = 'dependiente-card';
    card.dataset.index = index;

    card.innerHTML = `
      <div class="dependiente-header">
        <h4>Integrante ${index}</h4>
        <button type="button" class="dependiente-remove">Eliminar</button>
      </div>
      <div class="field-grid">
        <div class="field field-full">
          <label for="dep_nombre_${index}">Nombre completo</label>
          <input type="text" id="dep_nombre_${index}" name="dep_nombre_${index}" placeholder="Nombre(s) y apellidos">
        </div>
        <div class="field">
          <label for="dep_relacion_${index}">Relaci√≥n</label>
          <select id="dep_relacion_${index}" name="dep_relacion_${index}">
            <option value="">Selecciona</option>
            <option value="C√≥nyuge">C√≥nyuge</option>
            <option value="Hijo(a)">Hijo(a)</option>
            <option value="Padre/Madre">Padre/Madre</option>
            <option value="Otro">Otro</option>
          </select>
        </div>
        <div class="field">
          <label for="dep_fecha_nac_${index}">Fecha de nacimiento</label>
          <input type="date" id="dep_fecha_nac_${index}" name="dep_fecha_nac_${index}">
        </div>
        <div class="field">
          <label for="dep_edad_${index}">Edad</label>
          <input type="number" id="dep_edad_${index}" name="dep_edad_${index}" readonly>
        </div>
        <div class="field">
          <label>Sexo</label>
          <div class="radio-row">
            <label><input type="radio" name="dep_sexo_${index}" value="Hombre"> Hombre</label>
            <label><input type="radio" name="dep_sexo_${index}" value="Mujer"> Mujer</label>
          </div>
        </div>
        <div class="field">
          <label>¬øCuenta actualmente con seguro de gastos m√©dicos?</label>
          <div class="radio-row">
            <label><input type="radio" name="dep_tiene_seguro_${index}" value="si"> S√≠</label>
            <label><input type="radio" name="dep_tiene_seguro_${index}" value="no"> No</label>
          </div>
        </div>
      </div>
    `;

    // edad autom√°tica para dependiente
    const fechaDep = card.querySelector(`#dep_fecha_nac_${index}`);
    const edadDep = card.querySelector(`#dep_edad_${index}`);
    fechaDep.addEventListener('change', ()=>{
      const age = calcEdadFromDate(fechaDep.value);
      if(age) edadDep.value = age;
    });

    // eliminar
    card.querySelector('.dependiente-remove').addEventListener('click', ()=>{
      dependientesBox.removeChild(card);
      depCount--;
      // Reetiquetar encabezados
      [...dependientesBox.children].forEach((c,idx)=>{
        const h4 = c.querySelector('h4');
        if(h4) h4.textContent = 'Integrante ' + (idx+1);
      });
    });

    return card;
  }

  radiosTipoContratacion.forEach(r=>{
    r.addEventListener('change', ()=>{
      if(r.value === 'Titular y familia'){
        dependientesWrapper.style.display = 'block';
        if(depCount === 0) {
          depCount = 1;
          dependientesBox.appendChild(createDependienteCard(depCount));
        }
      }else{
        dependientesWrapper.style.display = 'none';
        dependientesBox.innerHTML = '';
        depCount = 0;
      }
    });
  });

  addDepBtn.addEventListener('click', ()=>{
    if(depCount >= MAX_DEP) return;
    depCount++;
    dependientesBox.appendChild(createDependienteCard(depCount));
  });

  // 4) Mostrar campos condicionales en secci√≥n m√©dica
  function handleConditionalRadios(){
    const conditionalBlocks = document.querySelectorAll('[data-conditional]');
    conditionalBlocks.forEach(block=>{
      const rule = block.getAttribute('data-conditional'); // ej: "toma_medicamentos:si"
      if(!rule) return;
      const [name, val] = rule.split(':');
      const radios = document.querySelectorAll(`input[name="${name}"]`);
      const update = ()=>{
        let show = false;
        radios.forEach(r=>{
          if(r.checked && r.value === val) show = true;
        });
        block.style.display = show ? 'block' : 'none';
      };
      radios.forEach(r=>r.addEventListener('change', update));
      update(); // estado inicial
    });
  }
  handleConditionalRadios();

  // 5) Validaci√≥n antes de enviar + mensaje WhatsApp
  const errorsBox = $('formErrors');
  const errorsList = $('errorsList');
  const sendBtn = $('sendWhatsApp');

  function getRadioValue(name){
    const r = document.querySelector(`input[name="${name}"]:checked`);
    return r ? r.value : '';
  }
  function getCheckboxValues(name){
    return [...document.querySelectorAll(`input[name="${name}"]:checked`)].map(el=>el.value);
  }

  function validateForm(){
    const errors = [];

    // Titular b√°sico
    if(!$('titular_nombre').value.trim()) errors.push('‚Ä¢ Nombre completo del titular.');
    if(!$('titular_rfc').value.trim()) errors.push('‚Ä¢ RFC del titular.');
    if(!$('titular_fecha_nac').value) errors.push('‚Ä¢ Fecha de nacimiento del titular.');
    if(!getRadioValue('titular_sexo')) errors.push('‚Ä¢ Sexo del titular.');
    if(!$('titular_telefono').value.trim()) errors.push('‚Ä¢ Tel√©fono m√≥vil del titular.');
    if(!$('titular_email').value.trim()) errors.push('‚Ä¢ Correo electr√≥nico del titular.');
    if(!$('titular_ciudad').value.trim()) errors.push('‚Ä¢ Ciudad y estado del titular.');

    // Cobertura
    if(!getRadioValue('tipo_contratacion')) errors.push('‚Ä¢ Seleccionar si el seguro es solo para ti o tambi√©n para tu familia.');
    if(!getRadioValue('situacion_seguro')) errors.push('‚Ä¢ Indicar tu situaci√≥n actual respecto a seguros de gastos m√©dicos.');

    // Salud b√°sica
    if(!getRadioValue('toma_medicamentos')) errors.push('‚Ä¢ Indicar si actualmente tomas alg√∫n medicamento.');
    if(!getRadioValue('cirugias_previas')) errors.push('‚Ä¢ Indicar si has tenido cirug√≠as previas.');
    if(!getRadioValue('hospitalizaciones')) errors.push('‚Ä¢ Indicar si has estado hospitalizado en los √∫ltimos 5 a√±os.');
    if(!getRadioValue('fuma_actualmente')) errors.push('‚Ä¢ Indicar si fumas actualmente.');

    // Si marc√≥ condiciones, sugerimos usar el cuadro de detalles
    const conds = getCheckboxValues('cond_preexistentes');
    if(conds.length > 0 && !$('detalles_medicos').value.trim()){
      errors.push('‚Ä¢ Agregar una breve explicaci√≥n en ‚ÄúDetalles m√©dicos adicionales‚Äù sobre las condiciones marcadas.');
    }

    if(errors.length > 0){
      errorsList.innerHTML = errors.map(e=>`<li>${e}</li>`).join('');
      errorsBox.style.display = 'block';
      window.scrollTo({top:0,behavior:'smooth'});
      return false;
    }else{
      errorsBox.style.display = 'none';
      errorsList.innerHTML = '';
      return true;
    }
  }

  function buildWhatsAppMessage(){
    const nombreTitular = $('titular_nombre').value.trim();
    const edadTitular = $('titular_edad').value || '';
    const ciudad = $('titular_ciudad').value.trim();
    const tel = $('titular_telefono').value.trim();
    const correo = $('titular_email').value.trim();

    const tipoContr = getRadioValue('tipo_contratacion');
    const situacion = getRadioValue('situacion_seguro');
    const nivelHosp = $('nivel_hospitalario').value || 'Sin especificar';
    const zonaHosp = $('zona_hospitalaria').value || 'Sin especificar';

    const tomaMed = getRadioValue('toma_medicamentos') || 'Sin responder';
    const cirPrev = getRadioValue('cirugias_previas') || 'Sin responder';
    const hosp = getRadioValue('hospitalizaciones') || 'Sin responder';
    const fuma = getRadioValue('fuma_actualmente') || 'Sin responder';
    const conds = getCheckboxValues('cond_preexistentes');
    const condsTxt = conds.length>0 ? conds.join(', ') : 'Ninguna indicada';
    const detallesMed = $('detalles_medicos').value.trim() || 'Sin comentarios adicionales.';

    const msg = [
      'Hola Christian, te env√≠o mi cuestionario previo de Gastos M√©dicos Mayores.',
      '',
      'DATOS DEL TITULAR',
      `‚Ä¢ Nombre: ${nombreTitular}`,
      edadTitular ? `‚Ä¢ Edad: ${edadTitular} a√±os` : '',
      `‚Ä¢ Ciudad: ${ciudad}`,
      `‚Ä¢ Tel√©fono: ${tel}`,
      `‚Ä¢ Correo: ${correo}`,
      '',
      'COBERTURA SOLICITADA',
      `‚Ä¢ Tipo de contrataci√≥n: ${tipoContr || 'Sin especificar'}`,
      `‚Ä¢ Situaci√≥n actual: ${situacion || 'Sin especificar'}`,
      `‚Ä¢ Red hospitalaria de inter√©s: ${nivelHosp}`,
      `‚Ä¢ Zona de atenci√≥n: ${zonaHosp}`,
      '',
      'SALUD Y ANTECEDENTES (resumen)',
      `‚Ä¢ Medicamentos actuales: ${tomaMed}`,
      `‚Ä¢ Cirug√≠as previas: ${cirPrev}`,
      `‚Ä¢ Hospitalizaciones √∫ltimos 5 a√±os: ${hosp}`,
      `‚Ä¢ ¬øFuma actualmente?: ${fuma}`,
      `‚Ä¢ Condiciones m√©dicas indicadas: ${condsTxt}`,
      '',
      'DETALLES M√âDICOS ADICIONALES',
      detallesMed,
      '',
      'En caso de que falte alg√∫n dato, lo podemos complementar en la llamada.'
    ].filter(Boolean).join('\n');

    return encodeURIComponent(msg);
  }

  sendBtn.addEventListener('click', ()=>{
    if(!validateForm()) return;
    const text = buildWhatsAppMessage();
    const phone = '526624176032'; // n√∫mero de Christian para seguros
    const url = `https://wa.me/${phone}?text=${text}`;
    window.open(url, '_blank');
  });
</script>
</body>
</html>
