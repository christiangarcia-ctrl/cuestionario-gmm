<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Cuestionario Inicial de Salud ¬∑ GMM | Christian GarBa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --brand: #0b5ed7;
      --brand-dark: #0842a0;
      --bg: #f3f4f6;
      --panel: #ffffff;
      --border: #d1d5db;
      --text: #111827;
      --muted: #6b7280;
      --danger: #b91c1c;
      --success: #047857;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.12);
      --radius-lg: 18px;
      --radius-full: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e5f0ff 0, #eff2f7 40%, #e5e7eb 100%);
      color: var(--text);
    }

    .app {
      max-width: 1120px;
      margin: 32px auto 48px;
      padding: 0 16px 64px;
    }

    .card {
      background: rgba(255, 255, 255, 0.98);
      box-shadow: var(--shadow-soft);
      border-radius: 28px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 28px;
      background: linear-gradient(
        120deg,
        #001f4f 0,
        #0b5ed7 40%,
        #1d4ed8 100%
      );
      color: #f9fafb;
    }

    header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-logo img {
      height: 54px;
      width: auto;
      display: block;
      border-radius: 14px;
      background: #ffffff;
      padding: 6px 10px;
    }

    .header-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .header-title-main {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.01em;
    }

    .header-title-sub {
      font-size: 13px;
      opacity: 0.9;
    }

    .header-contact {
      text-align: right;
      font-size: 13px;
      line-height: 1.5;
    }

    .header-contact strong {
      display: block;
      font-weight: 600;
    }

    /* Intro band */
    .intro {
      padding: 18px 28px 16px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.45);
      background: linear-gradient(
        90deg,
        rgba(59, 130, 246, 0.08),
        rgba(59, 130, 246, 0)
      );
    }

    .intro-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .intro-text {
      font-size: 13px;
      color: var(--muted);
      max-width: 880px;
    }

    /* Steps */
    .steps {
      display: flex;
      gap: 10px;
      padding: 14px 24px 4px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.3);
      background: #f9fafb;
    }

    .step-pill {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: var(--radius-full);
      font-size: 13px;
      border: 1px solid transparent;
      cursor: default;
      color: #6b7280;
      background: transparent;
    }

    .step-pill-index {
      height: 22px;
      width: 22px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      border: 1px solid #cbd5f5;
      background: #ffffff;
    }

    .step-pill-label {
      font-weight: 500;
    }

    .step-pill.active {
      color: #0b1120;
      background: #e0edff;
      border-color: #93c5fd;
    }

    .step-pill.active .step-pill-index {
      background: var(--brand);
      border-color: var(--brand);
      color: #ffffff;
    }

    .step-pill.done {
      color: #065f46;
      background: #dcfce7;
      border-color: #4ade80;
    }

    /* Form body */
    .body {
      padding: 20px 24px 28px;
    }

    @media (min-width: 900px) {
      .body {
        padding: 24px 32px 32px;
      }
    }

    form {
      margin: 0;
    }

    .step-panel {
      display: none;
      animation: fadeIn 0.2s ease-out;
    }

    .step-panel.active {
      display: block;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .section-subtitle {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 18px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 14px 18px;
    }

    @media (min-width: 840px) {
      .grid-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 13px;
    }

    .field label {
      font-weight: 500;
      color: #111827;
    }

    .required {
      color: #dc2626;
      margin-left: 2px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 9px 11px;
      font-size: 13px;
      font-family: inherit;
      outline: none;
      background: #f9fafb;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.35);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .field-inline {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 13px;
    }

    .chips {
      display: inline-flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .chip {
      border-radius: 999px;
      padding: 5px 10px;
      border: 1px solid var(--border);
      background: #f9fafb;
      cursor: pointer;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip input {
      display: none;
    }

    .chip.active {
      border-color: var(--brand);
      background: #e0edff;
      color: #0b1120;
      font-weight: 500;
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
    }

    .field-error input,
    .field-error select,
    .field-error textarea {
      border-color: var(--danger);
      background: #fef2f2;
    }

    .error-text {
      font-size: 11px;
      color: var(--danger);
    }

    .form-errors {
      display: none;
      margin-bottom: 14px;
      padding: 9px 11px;
      border-radius: 10px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      font-size: 12px;
      color: #7f1d1d;
    }

    .form-errors.active {
      display: block;
    }

    /* Dependientes */
    .dependientes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .dependientes-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .dependiente-card {
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 12px 12px 10px;
      background: #f9fafb;
    }

    .dependiente-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      font-size: 13px;
      font-weight: 500;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 11px;
      background: #e5f3ff;
      color: #1d4ed8;
    }

    .btn-icon {
      border: none;
      background: transparent;
      color: #9ca3af;
      cursor: pointer;
      padding: 4px;
      border-radius: 999px;
    }

    .btn-icon:hover {
      background: rgba(15, 23, 42, 0.05);
      color: #4b5563;
    }

    .dependiente-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 10px;
    }

    @media (min-width: 900px) {
      .dependiente-grid {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }
    }

    /* Summary */
    .summary-block {
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      padding: 14px 14px 12px;
      margin-bottom: 12px;
      background: #f9fafb;
    }

    .summary-block-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      padding: 2px 0;
      gap: 12px;
    }

    .summary-row-label {
      color: #4b5563;
      min-width: 120px;
    }

    .summary-row-value {
      color: #111827;
      text-align: right;
      flex: 1;
    }

    .disclaimer {
      font-size: 11px;
      color: var(--muted);
      margin-top: 10px;
      line-height: 1.5;
    }

    /* Footer nav */
    .footer-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding-top: 18px;
      margin-top: 8px;
      border-top: 1px solid rgba(148, 163, 184, 0.35);
    }

    .btn {
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      padding: 9px 16px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .btn-primary {
      background: var(--brand);
      color: #ffffff;
      box-shadow: 0 14px 30px rgba(37, 99, 235, 0.35);
    }

    .btn-primary:hover {
      background: var(--brand-dark);
    }

    .btn-primary:disabled {
      opacity: 0.65;
      cursor: default;
      box-shadow: none;
    }

    .step-hint {
      font-size: 11px;
      color: var(--muted);
    }

    /* Floating WhatsApp helper */
    .floating-whatsapp {
      position: fixed;
      right: 18px;
      bottom: 18px;
      z-index: 20;
    }

    .floating-whatsapp a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 13px;
      background: #22c55e;
      color: #ffffff;
      text-decoration: none;
      box-shadow: 0 16px 35px rgba(22, 163, 74, 0.55);
    }

    .floating-whatsapp a:hover {
      background: #16a34a;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <header>
        <div class="header-left">
          <div class="header-logo">
            <img src="logo-garba.png" alt="Christian GarBa ¬∑ Seguros con Estrategia" />
          </div>
          <div class="header-title">
            <div class="header-title-main">
              Cuestionario Inicial de Salud ¬∑ GMM
            </div>
            <div class="header-title-sub">
              Informaci√≥n clave para cotizar tu Seguro de Gastos M√©dicos Mayores
            </div>
          </div>
        </div>
        <div class="header-contact">
          <strong>Christian GarBa</strong>
          <span>Seguros con Estrategia</span><br />
          <span>üìû 662 417 6032</span><br />
          <span>‚úâÔ∏è christian.garcia@sfgarba.com.mx</span>
        </div>
      </header>

      <div class="intro">
        <div class="intro-title">
          Antes de cotizar, necesito entender un poco de tu salud y la de tu familia.
        </div>
        <div class="intro-text">
          La informaci√≥n que compartas se usa √∫nicamente para evaluar opciones de seguro y, en su momento,
          para la contrataci√≥n (si as√≠ lo decides). Entre m√°s clara y completa sea, m√°s s√≥lido ser√° el respaldo
          de tu p√≥liza cuando la necesites.
        </div>
      </div>

      <div class="steps">
        <div class="step-pill active" data-step-pill="1">
          <div class="step-pill-index">1</div>
          <div class="step-pill-label">Titular</div>
        </div>
        <div class="step-pill" data-step-pill="2">
          <div class="step-pill-index">2</div>
          <div class="step-pill-label">Familia</div>
        </div>
        <div class="step-pill" data-step-pill="3">
          <div class="step-pill-index">3</div>
          <div class="step-pill-label">Salud y antecedentes</div>
        </div>
        <div class="step-pill" data-step-pill="4">
          <div class="step-pill-index">4</div>
          <div class="step-pill-label">Confirmaci√≥n y env√≠o</div>
        </div>
      </div>

      <div class="body">
        <form id="gmmForm" novalidate>
          <div id="formErrors" class="form-errors">
            Revisa los campos marcados en rojo antes de continuar.
          </div>

          <!-- PASO 1: TITULAR -->
          <section class="step-panel active" data-step="1">
            <h2 class="section-title">1. Datos del titular</h2>
            <p class="section-subtitle">
              El titular debe ser mayor de 18 a√±os. Si el seguro es solo para tus hijos, t√∫ sigues siendo la
              persona titular.
            </p>

            <div class="grid-2">
              <div class="field">
                <label>Nombre(s) <span class="required">*</span></label>
                <input
                  type="text"
                  id="titular_nombre"
                  name="titular_nombre"
                  required
                  placeholder="Ej. Christian Iv√°n"
                />
              </div>

              <div class="field">
                <label>Apellidos <span class="required">*</span></label>
                <input
                  type="text"
                  id="titular_apellidos"
                  name="titular_apellidos"
                  required
                  placeholder="Apellidos completos"
                />
              </div>

              <div class="field">
                <label>RFC (persona f√≠sica) <span class="required">*</span></label>
                <input
                  type="text"
                  id="titular_rfc"
                  name="titular_rfc"
                  required
                  placeholder="Ej. GABC800619XXX"
                />
                <div class="hint">
                  Si lo capturas con formato correcto, intentar√© sugerir la fecha de nacimiento.
                </div>
              </div>

              <div class="field">
                <label>Fecha de nacimiento <span class="required">*</span></label>
                <input
                  type="date"
                  id="titular_nacimiento"
                  name="titular_nacimiento"
                  required
                />
                <div class="hint">El titular debe tener al menos 18 a√±os.</div>
              </div>

              <div class="field">
                <label>Edad (se calcula autom√°ticamente)</label>
                <input
                  type="number"
                  id="titular_edad"
                  name="titular_edad"
                  readonly
                  placeholder="Se calcular√° con tu fecha de nacimiento"
                />
              </div>

              <div class="field">
                <label>Sexo biol√≥gico <span class="required">*</span></label>
                <div class="chips" id="sexo_chips">
                  <label class="chip">
                    <input type="radio" name="titular_sexo" value="Hombre" required />
                    <span>Hombre</span>
                  </label>
                  <label class="chip">
                    <input type="radio" name="titular_sexo" value="Mujer" required />
                    <span>Mujer</span>
                  </label>
                </div>
              </div>

              <div class="field">
                <label>Estatura (cm)</label>
                <input
                  type="number"
                  id="titular_estatura"
                  name="titular_estatura"
                  placeholder="Ej. 172"
                />
              </div>

              <div class="field">
                <label>Peso (kg)</label>
                <input
                  type="number"
                  id="titular_peso"
                  name="titular_peso"
                  placeholder="Ej. 80"
                />
              </div>

              <div class="field">
                <label>Correo electr√≥nico <span class="required">*</span></label>
                <input
                  type="email"
                  id="titular_email"
                  name="titular_email"
                  required
                  placeholder="Ej. tu@correo.com"
                />
              </div>

              <div class="field">
                <label>Ciudad y estado <span class="required">*</span></label>
                <input
                  type="text"
                  id="titular_ciudad"
                  name="titular_ciudad"
                  required
                  placeholder="Ej. Hermosillo, Sonora"
                />
              </div>

              <div class="field">
                <label>Ocupaci√≥n / actividad principal <span class="required">*</span></label>
                <input
                  type="text"
                  id="titular_ocupacion"
                  name="titular_ocupacion"
                  required
                  placeholder="Ej. independiente, empleado, empresario, etc."
                />
              </div>

              <!-- NUEVO BLOQUE: SITUACI√ìN ACTUAL DE SEGURO -->
              <div class="field">
                <label>Situaci√≥n actual de seguro de GMM <span class="required">*</span></label>
                <select id="situacion_gmm" name="situacion_gmm" required>
                  <option value="">Selecciona una opci√≥n‚Ä¶</option>
                  <option value="Tengo seguro de GMM y quiero mejorarlo o cambiarlo">
                    Tengo seguro de GMM y quiero mejorarlo / cambiarlo
                  </option>
                  <option value="Tuve seguro de GMM pero actualmente no lo tengo">
                    Tuve seguro de GMM pero actualmente no lo tengo
                  </option>
                  <option value="Nunca he tenido un seguro de GMM">
                    Nunca he tenido un seguro de GMM
                  </option>
                </select>
                <div class="hint">
                  Esto me ayuda a enfocarme mejor en tu an√°lisis y propuesta.
                </div>
              </div>

              <div class="field">
                <label>Detalles de tu seguro actual (opcional)</label>
                <textarea
                  id="seguro_actual_detalles"
                  name="seguro_actual_detalles"
                  rows="3"
                  placeholder="Aseguradora, plan, deducible, coaseguro, hospital principal, si subi√≥ la prima, etc."
                ></textarea>
              </div>

              <div class="field">
                <label>Tel√©fono m√≥vil / WhatsApp <span class="required">*</span></label>
                <input
                  type="tel"
                  id="titular_movil"
                  name="titular_movil"
                  required
                  placeholder="10 d√≠gitos"
                />
              </div>
            </div>
          </section>

          <!-- PASO 2: FAMILIA -->
          <section class="step-panel" data-step="2">
            <h2 class="section-title">2. Familia y asegurados adicionales</h2>
            <p class="section-subtitle">
              Si quieres incluir a tu pareja e hijos, agr√©galos aqu√≠. Solo usar√© esta informaci√≥n para
              cotizar correctamente su protecci√≥n.
            </p>

            <div class="dependientes-header">
              <div class="step-hint">
                Puedes agregar hasta 5 personas adicionales (pareja e hijos).
              </div>
              <button type="button" class="btn btn-secondary" id="btnAddDependiente">
                + Agregar integrante
              </button>
            </div>

            <div id="dependientesList" class="dependientes-list"></div>

            <div class="hint">
              Si por ahora solo quieres cotizar para ti, puedes dejar este paso en blanco.
            </div>
          </section>

          <!-- PASO 3: SALUD -->
          <section class="step-panel" data-step="3">
            <h2 class="section-title">3. Salud y antecedentes</h2>
            <p class="section-subtitle">
              Esta secci√≥n es muy importante. No se trata de ‚Äúestar perfecto‚Äù, sino de que la aseguradora tenga
              claridad desde el inicio. Eso evita problemas al momento de un siniestro.
            </p>

            <div class="grid-2">
              <div class="field">
                <label>
                  ¬øTienes alguna enfermedad cr√≥nica o diagn√≥stico importante?
                  <span class="required">*</span>
                </label>
                <textarea
                  id="titular_padecimientos"
                  name="titular_padecimientos"
                  required
                  placeholder="Ej. hipertensi√≥n, diabetes, asma, colesterol alto, problemas de tiroides, etc. Si no, escribe 'Ninguno'."
                ></textarea>
              </div>

              <div class="field">
                <label>¬øTomas medicamentos de forma permanente? <span class="required">*</span></label>
                <textarea
                  id="titular_medicamentos"
                  name="titular_medicamentos"
                  required
                  placeholder="Nombre del medicamento, dosis y desde cu√°ndo. Si no, escribe 'Ninguno'."
                ></textarea>
              </div>

              <div class="field">
                <label>Cirug√≠as u hospitalizaciones previas <span class="required">*</span></label>
                <textarea
                  id="titular_cirugias"
                  name="titular_cirugias"
                  required
                  placeholder="Tipo de cirug√≠a, a√±o y si qued√≥ alguna secuela. Si no, escribe 'Ninguna'."
                ></textarea>
              </div>

              <div class="field">
                <label>
                  ¬øFumas actualmente o fumaste de forma regular?
                  <span class="required">*</span>
                </label>
                <textarea
                  id="titular_tabaco"
                  name="titular_tabaco"
                  required
                  placeholder="Ej. 'No fumo', o 'Fum√© 10 a√±os, dej√© en 2018', o 'Fumo 5 cigarrillos al d√≠a desde 2015'."
                ></textarea>
              </div>

              <div class="field">
                <label>Otros antecedentes relevantes</label>
                <textarea
                  id="titular_otros"
                  name="titular_otros"
                  placeholder="Ej. tratamientos en curso, estudios pendientes, recomendaciones m√©dicas recientes, etc."
                ></textarea>
              </div>
            </div>
          </section>

          <!-- PASO 4: CONFIRMACI√ìN -->
          <section class="step-panel" data-step="4">
            <h2 class="section-title">4. Confirmaci√≥n y env√≠o</h2>
            <p class="section-subtitle">
              Revisa un resumen de la informaci√≥n capturada. Si todo est√° correcto, env√≠ame tu cuestionario por
              WhatsApp para continuar con tu an√°lisis y propuesta.
            </p>

            <div id="summaryTitular" class="summary-block">
              <div class="summary-block-title">Titular</div>
              <div class="summary-body"></div>
            </div>

            <div id="summarySituacion" class="summary-block">
              <div class="summary-block-title">Situaci√≥n actual de seguro GMM</div>
              <div class="summary-body"></div>
            </div>

            <div id="summaryFamilia" class="summary-block">
              <div class="summary-block-title">Integrantes adicionales</div>
              <div class="summary-body"></div>
            </div>

            <div id="summarySalud" class="summary-block">
              <div class="summary-block-title">Salud y antecedentes</div>
              <div class="summary-body"></div>
            </div>

            <div class="field" style="margin-top: 10px;">
              <label>
                <input
                  type="checkbox"
                  id="confirm_veracidad"
                  required
                  style="margin-right: 6px;"
                />
                Confirmo que la informaci√≥n proporcionada es verdadera y est√° basada en mi mejor conocimiento.
              </label>
              <div class="hint">
                No se trata de ‚Äúperfecci√≥n m√©dica‚Äù, sino de transparencia. Mientras m√°s clara sea la informaci√≥n,
                mejor respaldo tendr√°s cuando necesites usar tu seguro.
              </div>
            </div>

            <p class="disclaimer">
              La informaci√≥n contenida en este cuestionario es confidencial y ser√° utilizada √∫nicamente para fines
              de asesor√≠a y cotizaci√≥n de seguro de Gastos M√©dicos Mayores.
            </p>
          </section>

          <!-- Navegaci√≥n -->
          <div class="footer-nav">
            <button type="button" class="btn btn-secondary" id="btnPrev">
              ‚¨Ö Anterior
            </button>
            <div style="display: flex; align-items: center; gap: 10px;">
              <div class="step-hint" id="stepHint">
                Paso 1 de 4
              </div>
              <button type="button" class="btn btn-primary" id="btnNext">
                Siguiente ‚ûú
              </button>
              <button
                type="button"
                class="btn btn-primary"
                id="btnEnviar"
                style="display: none;"
              >
                Enviar a mi asesor por WhatsApp
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bot√≥n flotante de ayuda -->
  <div class="floating-whatsapp">
    <a href="https://wa.me/526624176032" target="_blank" rel="noopener noreferrer">
      üí¨ Escribir a Christian
    </a>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("gmmForm");
      const steps = Array.from(document.querySelectorAll(".step-panel"));
      const pills = Array.from(document.querySelectorAll(".step-pill"));
      const btnPrev = document.getElementById("btnPrev");
      const btnNext = document.getElementById("btnNext");
      const btnEnviar = document.getElementById("btnEnviar");
      const stepHint = document.getElementById("stepHint");
      const formErrors = document.getElementById("formErrors");

      let currentStep = 1;

      function showStep(step) {
        currentStep = step;
        steps.forEach((panel) => {
          panel.classList.toggle(
            "active",
            Number(panel.dataset.step) === step
          );
        });

        pills.forEach((pill, idx) => {
          const num = idx + 1;
          pill.classList.toggle("active", num === step);
          pill.classList.toggle("done", num < step);
        });

        btnPrev.style.visibility = step === 1 ? "hidden" : "visible";

        if (step === steps.length) {
          btnNext.style.display = "none";
          btnEnviar.style.display = "inline-flex";
          buildSummary();
        } else {
          btnNext.style.display = "inline-flex";
          btnEnviar.style.display = "none";
        }

        stepHint.textContent = `Paso ${step} de ${steps.length}`;
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function validateStep(step) {
        formErrors.classList.remove("active");
        const stepPanel = steps.find((p) => Number(p.dataset.step) === step);
        if (!stepPanel) return true;

        const requiredFields = stepPanel.querySelectorAll("[required]");
        let valid = true;

        requiredFields.forEach((field) => {
          const wrapper = field.closest(".field") || field.parentElement;
          wrapper.classList.remove("field-error");

          let valueOk = true;

          if (field.type === "checkbox" || field.type === "radio") {
            const group =
              field.name &&
              stepPanel.querySelectorAll(
                `input[name="${CSS.escape(field.name)}"]`
              );
            if (group && group.length > 1 && field.type === "radio") {
              valueOk = Array.from(group).some((r) => r.checked);
            } else {
              valueOk = field.checked;
            }
          } else {
            valueOk = field.value.trim() !== "";
          }

          if (!valueOk) {
            valid = false;
            wrapper.classList.add("field-error");
          }
        });

        if (!valid) {
          formErrors.classList.add("active");
        }

        return valid;
      }

      btnPrev.addEventListener("click", () => {
        if (currentStep > 1) showStep(currentStep - 1);
      });

      btnNext.addEventListener("click", () => {
        if (!validateStep(currentStep)) return;
        if (currentStep < steps.length) showStep(currentStep + 1);
      });

      btnEnviar.addEventListener("click", () => {
        if (!validateStep(currentStep)) return;
        sendWhatsApp();
      });

      // Chips sexo
      document
        .getElementById("sexo_chips")
        .addEventListener("click", (e) => {
          const chip = e.target.closest(".chip");
          if (!chip) return;
          const input = chip.querySelector("input");
          if (!input) return;
          input.checked = true;
          document
            .querySelectorAll('#sexo_chips .chip')
            .forEach((c) => c.classList.remove("active"));
          chip.classList.add("active");
        });

      // C√°lculo de edad con fecha de nacimiento
      const fechaNacimiento = document.getElementById("titular_nacimiento");
      const edadInput = document.getElementById("titular_edad");

      function calcularEdad(value) {
        const date = new Date(value);
        if (isNaN(date)) return "";
        const hoy = new Date();
        let edad = hoy.getFullYear() - date.getFullYear();
        const m = hoy.getMonth() - date.getMonth();
        if (m < 0 || (m === 0 && hoy.getDate() < date.getDate())) {
          edad--;
        }
        return edad;
      }

      fechaNacimiento.addEventListener("change", () => {
        const edad = calcularEdad(fechaNacimiento.value);
        edadInput.value = edad || "";
      });

      // DEPENDIENTES
      const dependientesList = document.getElementById("dependientesList");
      const btnAddDependiente = document.getElementById("btnAddDependiente");
      let dependienteIndex = 0;
      const MAX_DEP = 5;

      function createDependienteCard(index) {
        const card = document.createElement("div");
        card.className = "dependiente-card";
        card.dataset.index = index;

        card.innerHTML = `
          <div class="dependiente-card-header">
            <span>Integrante ${index + 1}</span>
            <button type="button" class="btn-icon" data-remove="${index}" title="Eliminar integrante">
              ‚úï
            </button>
          </div>
          <div class="dependiente-grid">
            <div class="field">
              <label>Nombre <span class="required">*</span></label>
              <input type="text" name="dep_nombre_${index}" required placeholder="Nombre(s)" />
            </div>
            <div class="field">
              <label>Parentesco <span class="required">*</span></label>
              <select name="dep_parentesco_${index}" required>
                <option value="">Selecciona...</option>
                <option value="C√≥nyuge">C√≥nyuge</option>
                <option value="Hijo(a)">Hijo(a)</option>
                <option value="Padre/Madre">Padre / Madre</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            <div class="field">
              <label>Fecha de nacimiento <span class="required">*</span></label>
              <input type="date" name="dep_nacimiento_${index}" required />
            </div>
            <div class="field">
              <label>Sexo <span class="required">*</span></label>
              <select name="dep_sexo_${index}" required>
                <option value="">Selecciona...</option>
                <option value="Hombre">Hombre</option>
                <option value="Mujer">Mujer</option>
              </select>
            </div>
          </div>
        `;

        return card;
      }

      btnAddDependiente.addEventListener("click", () => {
        const current = dependientesList.querySelectorAll(
          ".dependiente-card"
        ).length;
        if (current >= MAX_DEP) {
          alert("Por ahora solo permito agregar hasta 5 integrantes.");
          return;
        }
        const card = createDependienteCard(dependienteIndex++);
        dependientesList.appendChild(card);
      });

      dependientesList.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-remove]");
        if (!btn) return;
        const idx = btn.dataset.remove;
        const card = dependientesList.querySelector(
          `.dependiente-card[data-index="${idx}"]`
        );
        if (card) card.remove();
      });

      // RESUMEN
      function addSummaryRow(container, label, value) {
        if (!value) return;
        const row = document.createElement("div");
        row.className = "summary-row";
        row.innerHTML = `
          <div class="summary-row-label">${label}</div>
          <div class="summary-row-value">${value}</div>
        `;
        container.appendChild(row);
      }

      function buildSummary() {
        const data = new FormData(form);

        // Titular
        const titularBlock = document
          .getElementById("summaryTitular")
          .querySelector(".summary-body");
        titularBlock.innerHTML = "";

        addSummaryRow(
          titularBlock,
          "Nombre",
          `${data.get("titular_nombre") || ""} ${
            data.get("titular_apellidos") || ""
          }`
        );
        addSummaryRow(titularBlock, "RFC", data.get("titular_rfc"));
        addSummaryRow(titularBlock, "Fecha de nacimiento", data.get("titular_nacimiento"));
        addSummaryRow(titularBlock, "Edad", data.get("titular_edad"));
        addSummaryRow(titularBlock, "Sexo", data.get("titular_sexo"));
        addSummaryRow(
          titularBlock,
          "Estatura / Peso",
          `${data.get("titular_estatura") || "-"} cm ¬∑ ${
            data.get("titular_peso") || "-"
          } kg`
        );
        addSummaryRow(titularBlock, "Ciudad", data.get("titular_ciudad"));
        addSummaryRow(titularBlock, "Ocupaci√≥n", data.get("titular_ocupacion"));
        addSummaryRow(titularBlock, "Correo", data.get("titular_email"));
        addSummaryRow(titularBlock, "M√≥vil", data.get("titular_movil"));

        // Situaci√≥n actual de seguro
        const situacionBlock = document
          .getElementById("summarySituacion")
          .querySelector(".summary-body");
        situacionBlock.innerHTML = "";
        addSummaryRow(
          situacionBlock,
          "Estado actual",
          data.get("situacion_gmm")
        );
        addSummaryRow(
          situacionBlock,
          "Detalles del seguro actual",
          data.get("seguro_actual_detalles")
        );

        // Familia
        const familiaBlock = document
          .getElementById("summaryFamilia")
          .querySelector(".summary-body");
        familiaBlock.innerHTML = "";
        const depCards =
          dependientesList.querySelectorAll(".dependiente-card");
        if (!depCards.length) {
          familiaBlock.textContent = "Por ahora solo t√∫ est√°s considerado en la cotizaci√≥n.";
        } else {
          depCards.forEach((card, i) => {
            const idx = card.dataset.index;
            const nombre = data.get(`dep_nombre_${idx}`) || "";
            const parentesco = data.get(`dep_parentesco_${idx}`) || "";
            const fecha = data.get(`dep_nacimiento_${idx}`) || "";
            const sexo = data.get(`dep_sexo_${idx}`) || "";

            const row = document.createElement("div");
            row.className = "summary-row";
            row.innerHTML = `
              <div class="summary-row-label">Integrante ${i + 1}</div>
              <div class="summary-row-value">
                ${nombre} ¬∑ ${parentesco || "-"}<br />
                Nac.: ${fecha || "-"} ¬∑ Sexo: ${sexo || "-"}
              </div>
            `;
            familiaBlock.appendChild(row);
          });
        }

        // Salud
        const saludBlock = document
          .getElementById("summarySalud")
          .querySelector(".summary-body");
        saludBlock.innerHTML = "";
        addSummaryRow(
          saludBlock,
          "Enfermedades / diagn√≥sticos",
          data.get("titular_padecimientos")
        );
        addSummaryRow(
          saludBlock,
          "Medicamentos permanentes",
          data.get("titular_medicamentos")
        );
        addSummaryRow(
          saludBlock,
          "Cirug√≠as / hospitalizaciones",
          data.get("titular_cirugias")
        );
        addSummaryRow(
          saludBlock,
          "Tabaco",
          data.get("titular_tabaco")
        );
        addSummaryRow(
          saludBlock,
          "Otros antecedentes",
          data.get("titular_otros")
        );
      }

      // WhatsApp
      function sendWhatsApp() {
        const data = new FormData(form);

        let msg = "";
        msg += "üöë *CUESTIONARIO INICIAL DE SALUD ‚Äì GMM*%0A";
        msg += "Generado desde el formulario de GarBaTools.%0A%0A";

        msg += "üë§ *TITULAR*%0A";
        msg += `Nombre: ${data.get("titular_nombre") || ""} ${
          data.get("titular_apellidos") || ""
        }%0A`;
        msg += `RFC: ${data.get("titular_rfc") || "-"}%0A`;
        msg += `Fecha de nacimiento: ${
          data.get("titular_nacimiento") || "-"
        } (edad ${data.get("titular_edad") || "-"})%0A`;
        msg += `Sexo: ${data.get("titular_sexo") || "-"}%0A`;
        msg += `Estatura / Peso: ${data.get("titular_estatura") || "-"} cm ¬∑ ${
          data.get("titular_peso") || "-"
        } kg%0A`;
        msg += `Ciudad: ${data.get("titular_ciudad") || "-"}%0A`;
        msg += `Ocupaci√≥n: ${data.get("titular_ocupacion") || "-"}%0A`;
        msg += `Correo: ${data.get("titular_email") || "-"}%0A`;
        msg += `M√≥vil: ${data.get("titular_movil") || "-"}%0A%0A`;

        msg += "üö¶ *SITUACI√ìN ACTUAL DE SEGURO GMM*%0A";
        msg += `Estado: ${data.get("situacion_gmm") || "-"}%0A`;
        if (data.get("seguro_actual_detalles")) {
          msg += `Detalles: ${
            data.get("seguro_actual_detalles")
          }%0A`;
        }
        msg += "%0A";

        msg += "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ *INTEGRANTES ADICIONALES*%0A";
        const depCards =
          dependientesList.querySelectorAll(".dependiente-card");
        if (!depCards.length) {
          msg += "Solo se considera al titular por el momento.%0A%0A";
        } else {
          depCards.forEach((card, i) => {
            const idx = card.dataset.index;
            msg += `Integrante ${i + 1}: ${
              data.get(`dep_nombre_${idx}`) || "-"
            } (${data.get(`dep_parentesco_${idx}`) || "-"})%0A`;
            msg += `Nacimiento: ${
              data.get(`dep_nacimiento_${idx}`) || "-"
            } ¬∑ Sexo: ${data.get(`dep_sexo_${idx}`) || "-"}%0A%0A`;
          });
        }

        msg += "ü©∫ *SALUD Y ANTECEDENTES DEL TITULAR*%0A";
        msg += `Enfermedades / diagn√≥sticos:%0A${
          data.get("titular_padecimientos") || "-"
        }%0A%0A`;
        msg += `Medicamentos permanentes:%0A${
          data.get("titular_medicamentos") || "-"
        }%0A%0A`;
        msg += `Cirug√≠as / hospitalizaciones:%0A${
          data.get("titular_cirugias") || "-"
        }%0A%0A`;
        msg += `Tabaco:%0A${data.get("titular_tabaco") || "-"}%0A%0A`;
        if (data.get("titular_otros")) {
          msg += `Otros antecedentes:%0A${
            data.get("titular_otros")
          }%0A%0A`;
        }

        msg += "‚Äî%0A";
        msg += "Cuestionario enviado desde el formulario GMM de Christian GarBa.";

        const phone = "526624176032"; // n√∫mero al que te llegar√° el cuestionario
        const url = `https://wa.me/${phone}?text=${msg}`;
        window.open(url, "_blank");
      }

      // Inicial
      showStep(1);
    });
  </script>
</body>
</html>
